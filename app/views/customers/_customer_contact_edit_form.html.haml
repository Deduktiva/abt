-# Customer contact edit form with integrated error handling
- if local_assigns[:contact_errors] && contact_errors.any?
  %tr{id: "customer_contact_#{contact.id}_error"}
    %td{colspan: 5, style: 'padding: 0.25rem 0.75rem;'}
      .alert.alert-danger.mb-0{style: 'font-size: 0.875rem; padding: 0.25rem 0.5rem;'}
        = contact_errors.full_messages.join(", ")
%tr{id: "customer_contact_#{contact.id}", class: 'table-active', style: 'vertical-align: middle;', data: { contact_id: contact.id }}
  %td{style: 'padding: 0.5rem 0.75rem;'}
    = text_field_tag "name", contact.name, class: "form-control form-control-sm", required: true
  %td{style: 'padding: 0.5rem 0.75rem;'}
    = email_field_tag "email", contact.email, class: "form-control form-control-sm", required: true
  %td{style: 'padding: 0.5rem 0.75rem;'}
    .form-check
      = check_box_tag "receives_invoices", "1", contact.receives_invoices, class: "form-check-input"
      = label_tag "receives_invoices", "Invoices", class: "form-check-label"
  %td{style: 'padding: 0.5rem 0.75rem;'}
    - customer_projects = Project.active.where(bill_to_customer: contact.customer)
    - if customer_projects.any?
      = select_tag :project_ids,
        options_from_collection_for_select(customer_projects, :id, :display_name, contact.project_ids),
        { multiple: true, class: "form-select form-select-sm", size: 2, name: "project_ids[]" }
    - else
      %small.text-muted No projects available
  %td.text-center{style: 'padding: 0.5rem 0.75rem;'}
    .d-flex.gap-1.justify-content-center
      = button_tag "üíæ", type: "button", class: "btn btn-success btn-sm", title: "Save", onclick: "saveContact(#{contact.id})"
      = link_to "‚ùå", cancel_edit_customer_contact_path(contact, format: :turbo_stream),
        class: "btn btn-secondary btn-sm",
        title: "Cancel",
        data: { turbo_prefetch: false }